<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>All Users</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    .locked-row {
      background-color: #e9ecef !important;
      pointer-events: none;
    }
  </style>
</head>
<%- include("partials/headerAdmin") %>

<body class="bg-light">

  <div class="container mt-4">
    <h2 class="text-center mb-4">All Registered Users</h2>

    <div class="d-flex justify-content-between mb-3">
      <a href="/inventory" class="btn btn-secondary">‚Üê Back to Inventory</a>
      <a href="/logout" class="btn btn-danger">Logout</a>
    </div>

    <table class="table table-bordered table-hover shadow-sm bg-white text-center">
      <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>Username</th>
          <th>Email</th>
          <th>Role</th>
          <th>Edit Role</th>
          <th>Action</th>
        </tr>
      </thead>

      <tbody>

        <% users.forEach(user => { %>

          <% const isSelf = user.id === currentUserId; %>

          <tr class="<%= isSelf ? 'locked-row' : '' %>">

            <td><%= user.id %></td>
            <td><%= user.username %></td>
            <td><%= user.email %></td>
            <td><%= user.role %></td>

            <% if (isSelf) { %>

              
              <td>
                <span class="badge bg-secondary">Locked</span>
              </td>

              
              <td>
                <span class="badge bg-secondary">Locked</span>
              </td>

            <% } else { %>

              <td>
                <form action="/editrole/<%= user.id %>" method="POST" class="d-flex justify-content-center">
                  <select name="role" class="form-select form-select-sm w-auto me-2">
                    <option value="user" <%= user.role === 'user' ? 'selected' : '' %>>User</option>
                    <option value="admin" <%= user.role === 'admin' ? 'selected' : '' %>>Admin</option>
                  </select>
                  <button type="submit" class="btn btn-sm btn-primary">Update</button>
                </form>
              </td>

              <td>
                <form action="/deleteuser/<%= user.id %>" method="POST">
                  <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                </form>
              </td>

            <% } %>

          </tr>

        <% }) %>

      </tbody>

    </table>

  </div>

</body>
</html>
