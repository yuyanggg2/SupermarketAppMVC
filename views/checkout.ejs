<%- include('partials/header') %>

  <title>Checkout</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      background: linear-gradient(135deg, #eef4ff, #fdfcfb);
      font-family: "Poppins", sans-serif;
    }

    .checkout-title {
      font-size: 42px;
      font-weight: 800;
      text-align: center;
      margin-top: 20px;
      color: #1a1a1a;
    }
    
    .checkout-subtitle {
      text-align: center;
      font-size: 16px;
      color: #666;
      margin-bottom: 40px;
    }

    .section-title {
      font-weight: 600;
      font-size: 18px;
      margin-bottom: 10px;
      color: #333;
    }

    .order-summary-box {
      background: white;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.08);
      padding: 25px;
    }

    .total-box {
      background: #e8f7e8;
      border-radius: 12px;
      padding: 15px;
      margin-top: 15px;
      font-weight: 700;
      font-size: 1.3rem;
      color: #1d5c1d;
      display: flex;
      justify-content: space-between;
    }

    .delivery-option {
      border: 2px solid #dfe6f3;
      border-radius: 12px;
      padding: 15px;
      cursor: pointer;
      transition: 0.25s;
      margin-bottom: 15px;
    }

    .delivery-option:hover {
      border-color: #0d6efd;
      background: #f0f6ff;
    }

    .delivery-option.active {
      border-color: #0d6efd;
      background: #e6f0ff;
    }

    .confirm-btn {
      height: 60px;
      font-size: 1.4rem;
      font-weight: 600;
      border-radius: 12px;
      margin-top: 20px;
    }
  </style>
</head>


<body>

<div class="container pb-5">

  <!-- Title -->
  <h1 class="checkout-title">Checkout</h1>
  <p class="checkout-subtitle">Review your order and delivery details</p>


  <div class="row g-5">

    <!-- LEFT -->
    <div class="col-md-7">

      <form action="/checkout" method="POST">

        <!-- Name -->
        <div class="mb-4">
          <div class="section-title">Full Name</div>
          <input type="text" name="fullname" class="form-control" placeholder="John Tan" required>
        </div>

        <!-- Address -->
        <div class="mb-4">
          <div class="section-title">Shipping Address</div>
          <input type="text" name="address" class="form-control" placeholder="123 Orchard Road" required>
        </div>

        <!-- Delivery -->
        <div class="mb-4">
          <div class="section-title">Delivery Method</div>

          <select name="deliveryMethod" class="form-select form-select-lg" id="deliveryMethod">
            <option value="pickup">üè™ Self Pickup (Free)</option>
            <option value="delivery">üöö Delivery (+$5)</option>
          </select>

          <small id="deliveryInfo" class="text-primary mt-2 d-block" style="display:none;">
            Delivery: Estimated 2‚Äì3 days, fee included.
          </small>

          <small id="pickupInfo" class="text-secondary mt-2 d-block">
            Pickup: Ready within 1 hour.
          </small>
        </div>

        <!-- Payment -->
        <div class="mb-4">
          <div class="section-title">Payment Method</div>
          <select name="paymentMethod" class="form-select form-select-lg">
            <option value="Card">üí≥ Credit Card</option>
            <option value="PayNow">üì± PayNow</option>
            <option value="Cash">üíµ Cash on Delivery</option>
          </select>
        </div>

        <!-- Confirm -->
        <button class="btn btn-success w-100 confirm-btn" type="submit">
          Confirm Order ‚úî
        </button>

      </form>

    </div>


    <!-- RIGHT -->
    <div class="col-md-5">
      <div class="order-summary-box">

        <h4 class="fw-bold mb-3">üßæ Order Summary</h4>

        <% let subtotal = 0; %>
        <% cart.forEach(item => { subtotal += item.price * item.quantity; }) %>

        <% cart.forEach(item => { %>
          <div class="d-flex justify-content-between mb-2">
            <span><%= item.productName %> x <%= item.quantity %></span>
            <span>$<%= (item.price * item.quantity).toFixed(2) %></span>
          </div>
        <% }) %>

        <hr>

        <div class="d-flex justify-content-between">
          <span>Delivery Fee:</span>
          <strong id="deliveryFee">$0.00</strong>
        </div>

        <div class="total-box mt-3">
          <span>Total</span>
          <span id="finalTotal">$<%= subtotal.toFixed(2) %></span>
        </div>

      </div>
    </div>

  </div>

</div>


<script>
  // JS Logic
  let deliveryMethod = document.getElementById("deliveryMethod");
  let deliveryInfo = document.getElementById("deliveryInfo");
  let pickupInfo = document.getElementById("pickupInfo");
  let deliveryFee = document.getElementById("deliveryFee");
  let finalTotal = document.getElementById("finalTotal");

  let subtotal = parseFloat("<%= subtotal %>");
  let fee = 0;

  deliveryMethod.addEventListener("change", () => {
    if (deliveryMethod.value === "delivery") {
      fee = 5;
      deliveryInfo.style.display = "block";
      pickupInfo.style.display = "none";
    } else {
      fee = 0;
      deliveryInfo.style.display = "none";
      pickupInfo.style.display = "block";
    }

    deliveryFee.innerText = "$" + fee.toFixed(2);
    finalTotal.innerText = "$" + (subtotal + fee).toFixed(2);
  });
</script>


</body>
</html>
